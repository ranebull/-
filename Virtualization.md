# Курс лекций по виртуализации
### Первое занятие
### Что же такое виртуализация?
**Виртуализация** – это абстрактное предоставление ресурсов.

Причем, неважно, что за устройство предоставляет эти ресурсы – CPU, GPU, RAM, сети и т.д.  

Сам термин «виртуализация» в компьютерных технологиях появился в шестидесятых годах прошлого века вместе с термином «виртуальная машина»,
означающим продукт виртуализации программно-аппаратной платформы. В то время виртуализация была, скорее, интересной технической находкой,
чем перспективной технологией.  

Разработки в сфере виртуализации в шестидесятых-семидесятых годах проводились только компанией IBM.
С появлением в компьютере IBM M44/44X экспериментальной системы пэйджинга, впервые был употреблен термин
«виртуальная машина» (virtual machine),который заменил более ранний термин «псевдо машина» (pseudo machine). 
Затем в мэйнфреймах IBM серии System 360/370, можно было использовать виртуальные машины для сохранения
предыдущих версий операционных систем.  

До конца девяностых годов никто кроме IBM так и не решался использовать
эту оригинальную технологию всерьез. Однако в девяностых годах стали очевидны перспективы подхода виртуализации:
с ростом аппаратных мощностей, как персональных компьютеров, так и серверных решений,
вскоре представится возможность использовать несколько виртуальных машин на одной физической платформе.  

В данный момент от старых мейнфреймов стараются избавиться, консолидируя их в европейской части
(если у компании имеется такая возможность). Причин несколько – возраст у большинства мейнфреймов уже солидный,
а обслуживание дорого (для починки мейфрейма нужно обращаться в поддержку вендора, а это выходит в сумму
в несколько сотен или тысяч долларов).  

В дополнение к этому, в европейской части проще найти людей, 
которые всё ещё могут писать на COBOL – специалистов всё меньше и меньше, и большая часть из них уже пенсионеры. 
Новые же модели мейнфреймов от IBM из линейки LinuxOne – Emperor и Rockchopper – позволяют использовать Linux,
а значит использовать больше решений виртуализации и контейнеризации.  

В 1997 году компания Connectix выпускает первую версию Virtual PC для платформы Macintosh,
а в 1998 году VMware патентует свои техники виртуализации. Компания Connectix впоследствии была куплена корпорацией Microsoft,
а VMware корпорацией EMC, и на данный момент обе эти компании являются двумя основными потенциальными конкурентами на
рынке технологий виртуализации в будущем. Потенциальными — потому что сейчас VMware безоговорочный лидер на этом рынке,
однако у Microsoft, как всегда, есть козырь в рукаве.

### Виды виртуализации
Понятие виртуализации условно можно разделить на две фундаментально различающиеся категории:  
* **виртуализация платформ**  
Продуктом этого вида виртуализации являются виртуальные машины — некие программные абстракции, запускаемые на платформе реальных аппаратно-программных систем.
* **виртуализация ресурсов**  
Данный вид виртуализации преследует своей целью комбинирование или упрощение представления аппаратных ресурсов для пользователя и получение неких пользовательских абстракций оборудования, пространств имен, сетей и т.п.  


![test](http://www.ixbt.com/cm/images/virtualization/virtualization600.jpg)

### Виртуализация платформ
Под виртуализацией платформ понимают создание программных систем на основе существующих аппаратно-программных комплексов, зависящих или независящих от них. Система, предоставляющая аппаратные ресурсы и программное обеспечение, называется хостовой (host), а симулируемые ей системы — гостевыми (guest).    

Чтобы гостевые системы могли стабильно функционировать на платформе хостовой системы, необходимо, чтобы программное и аппаратное обеспечение хоста было достаточно надежным и предоставляло необходимый набор интерфейсов для доступа к его ресурсам. Есть несколько видов виртуализации платформ, в каждом из которых осуществляется свой подход к понятию «виртуализация». Виды виртуализации платформ зависят от того, насколько полно осуществляется симуляция аппаратного обеспечения.  

До сих пор нет единого соглашения о терминах в сфере виртуализации, поэтому некоторые из 
приведенных далее видов виртуализации могут отличаться от тех, что предоставят другие источники.  
####Виды виртуализации платформ
1. **Полная эмуляция (симуляция).**  
При таком виде виртуализации виртуальная машина полностью эмулирует все аппаратное обеспечение определенной платформы. Такой подход позволяет эмулировать различные аппаратные архитектуры.   
Например, можно запускать виртуальные машины с гостевыми системами для x86-процессоров на платформах с другой архитектурой (например, на RISC- серверах компании Sun). Долгое время такой вид виртуализации использовался, чтобы разрабатывать программное обеспечение для новых процессоров еще до того, как они были физически доступными.  
Такие эмуляторы также применяют для низкоуровневой отладки операционных систем. Основной минус данного подхода заключается в том, что эмулируемое аппаратное обеспечение весьма и весьма существенно замедляет быстродействие гостевой системы, что делает работу с ней очень неудобной, поэтому, кроме как для разработки системного программного обеспечения, а также образовательных целей, такой подход мало где используется.  
Примеры продуктов для создания эмуляторов: Bochs, PearPC, QEMU (без ускорения), Hercules Emulator.  
2. **Частичная эмуляция (нативная виртуализация).**
Частичная виртуализация базируется на принципе эмуляции только необходимого количества ресурсов, чтобы виртуальная машина могла быть запущена изолировано. Такой подход позволяет запускать гостевые операционные системы, разработанные только для той же архитектуры, что и у хоста.  
Таким образом, несколько экземпляров гостевых систем могут быть запущены одновременно. Этот вид виртуализации позволяет существенно увеличить быстродействие гостевых систем по сравнению с полной эмуляцией и широко используется в настоящее время. В целях повышения быстродействия в платформах виртуализации, использующих данный подход, применяется специальная «прослойка» между гостевой операционной системой и оборудованием (гипервизор), позволяющая гостевой системе напрямую обращаться к ресурсам аппаратного обеспечения. 
Гипервизор, называемый также «Монитор виртуальных машин» (Virtual Machine Monitor) — одно из ключевых понятий в мире виртуализации. Применение гипервизора, являющегося связующим звеном между гостевыми системами и аппаратурой, существенно увеличивает быстродействие платформы, приближая его к быстродействию физической платформы. К минусам данного вида виртуализации можно отнести зависимость виртуальных машин от архитектуры аппаратной платформы.  
Примеры продуктов для нативной виртуализации: VMware Workstation, VMware Server, VMware ESX Server, Virtual Iron, Virtual PC, VirtualBox, Parallels Desktop и другие. 
3. **Частичная виртуализация, а также «виртуализация адресного пространства» («address space virtualization»).**
Подход частичной виртуализации заключается в симулировании нескольких экземпляров аппаратного обеспечения (особенно часто используется виртуализация адресного пространства). Это позволяет совместно использовать ресурсы и изолировать процессы, но не позволяет создавать экземпляры гостевых систем.  
Строго говоря, при таком виде виртуализации пользователем не создаются виртуальные машины, а происходит изоляция каких-либо процессов на уровне операционной системы. В данный момент многие из известных операционных систем используют такой подход. Примером может послужить использование UML (User-mode Linux), в котором «гостевое» ядро запускается в пользовательском пространстве базового ядра (в его контексте).  
4. **Паравиртуализация.**
Метод паравиртуализации не вынуждает эмулировать аппаратное обеспечение, однако требует от гостевой системы наличия специального программного интерфейса для взаимодействия с хостовой системой. Такой подход требует модификации кода гостевой системы, что, с точки зрения сообщества, Open Source не так и критично.  
Системы для паравиртуализации также имеют свой гипервизор, а API-вызовы к гостевой системе, называются «hypercalls» (гипервызовы). Многие сомневаются в перспективах этого подхода виртуализации, поскольку в данный момент все решения производителей аппаратного обеспечения в отношении виртуализации направлены на системы с нативной виртуализацией, а поддержку паравиртуализации приходится искать у производителей операционных систем, которые слабо верят в возможности предлагаемого им средства.  
В настоящее время провайдерами паравиртуализации являются компании XenSource и Virtual Iron, утверждающие, что быстродействие паравиртуализации выше. 
5. **Виртуализация уровня операционной системы.**
Данный метод позволяет в рамках одной операционной системы выделить ресурсы для выполнения независимых гостевых операционных систем. Каждая гостевая система имеет изолированную от хостовой системы среду выполнения, что обеспечивает достаточную безопасность.   
Сутью данного вида виртуализации является виртуализация физического сервера на уровне операционной системы в целях создания нескольких защищенных виртуализованных серверов на одном физическом.   
Гостевая система, в данном случае, разделяет использование одного ядра хостовой операционной системы с другими гостевыми системами. Виртуальная машина представляет собой окружение для приложений, запускаемых изолированно. Данный тип виртуализации применяется при организации систем хостинга, когда в рамках одного экземпляра ядра требуется поддерживать несколько виртуальных серверов клиентов.  
Примеры виртуализации уровня ОС: Linux-VServer, Virtuozzo, OpenVZ, Solaris Containers и FreeBSD Jails. 
6. **Виртуализация уровня приложений.**
Виртуализация приложений значительно отличается от всех остальных видов виртуализации. Целевое приложение (а не вся операционная система) помещается в специальный контейнер, который эмулирует работу операционной системы с данным приложением. Контейнер содержит все необходимые приложению ресурсы: системные файлы, файлы реестра и конфигурационные файлы.  
Этот вид виртуализации не похож на все остальные: если в предыдущих случаях создаются виртуальные среды или виртуальные машины, использующиеся для изоляции приложений, то в данном случае само приложение помещается в контейнер с необходимыми элементами для своей работы: файлами реестра, конфигурационными файлами, пользовательскими и системными объектами. В результате получается приложение, не требующее установки на аналогичной платформе.  
При переносе такого приложения на другую машину и его запуске, виртуальное окружение, созданное для программы, разрешает конфликты между ней и операционной системой, а также другими приложениями. Такой способ виртуализации похож на поведение интерпретаторов различных языков программирования (недаром интерпретатор, Виртуальная Машина Java (JVM), тоже попадает в эту категорию).  
Примером такого подхода служат: Thinstall, Altiris, Trigence, Softricity. 
